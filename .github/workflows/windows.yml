name: Windows CI

on:
  workflow_dispatch:
  push:
    branches:
      - 'master'

jobs:
  Windows:
    name: build-windows
    runs-on: [windows-2022]

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Download qtbase
      run: |
        Invoke-WebRequest -Uri https://github.com/qt/qtbase/archive/refs/tags/v6.9.2.zip -OutFile qtbase.zip
        Expand-Archive -Path qtbase.zip
        Remove-Item qtbase.zip
        Invoke-WebRequest -Uri https://github.com/qt/qtdeclarative/archive/refs/tags/v6.9.2.zip -OutFile qtdeclarative.zip
        Expand-Archive -Path qtdeclarative.zip
        Remove-Item qtdeclarative.zip
        Invoke-WebRequest -Uri https://github.com/qt/qtsvg/archive/refs/tags/v6.9.2.zip -OutFile qtsvg.zip
        Expand-Archive -Path qtsvg.zip
        Remove-Item qtsvg.zip

        Get-ChildItem -Path qtbase

        New-Item -ItemType Directory -Path qtbase_build
        New-Item -ItemType Directory -Path qtdeclarative_build
        New-Item -ItemType Directory -Path qtsvg_build
        Set-Location qtbase_build
        ../qtbase/configure -icu
